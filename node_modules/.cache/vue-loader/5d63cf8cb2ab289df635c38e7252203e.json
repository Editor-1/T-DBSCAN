{"remainingRequest":"E:\\workspacevsCode\\web-ui-travel\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\workspacevsCode\\web-ui-travel\\src\\components\\ImageUpload\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\workspacevsCode\\web-ui-travel\\src\\components\\ImageUpload\\index.vue","mtime":1719903068000},{"path":"E:\\workspacevsCode\\web-ui-travel\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\workspacevsCode\\web-ui-travel\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\workspacevsCode\\web-ui-travel\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\workspacevsCode\\web-ui-travel\\node_modules\\vue-loader\\lib\\index.js","mtime":1720856215506}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmZ1bmN0aW9uIHZhbGlkYXRlSW1hZ2UoZmlsZSkgewogIGNvbnN0IGlzSnBnT3JQbmcgPSBmaWxlLnR5cGUgPT09ICdpbWFnZS9qcGVnJyB8fCBmaWxlLnR5cGUgPT09ICdpbWFnZS9wbmcnIHx8IGZpbGUudHlwZSA9PT0gJ2ltYWdlL2pwZycKICBpZiAoIWlzSnBnT3JQbmcpIHsKICAgIHJldHVybgogIH0KICBjb25zdCBpc0x0Mk0gPSBmaWxlLnNpemUgLyAxMDI0IC8gMTAyNCA8IDIwIC8vIDIwTQogIGlmICghaXNMdDJNKSB7CiAgICByZXR1cm4KICB9CiAgcmV0dXJuIGlzSnBnT3JQbmcgJiYgaXNMdDJNCn0KZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdJbWFnZVVwbG9hZCcsCiAgcHJvcHM6IHsKICAgIC8vIOm7mOiupOWIl+ihqAogICAgZmlsZUxpc3Q6IHsKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIHR5cGU6IEFycmF5CiAgICB9LAogICAgLy8g55So5oi35aS05YOPID0g44CLdXNlcu+8jOiuvuWkh+eFp+eJhyA944CLIGRldmljZe+8jOWFtOi2o+eCueeFp+eJhyA944CLcG9pIO+8jOaEj+ingeWPjemmiOeFp+eJhyA944CLIGFkdmljZQogICAgdHlwZTogewogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAnJwogICAgfSwKICAgIC8vIOmZkOWItuaVsOmHjwogICAgbnVtOiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogNgogICAgfSwKICAgIGxpc3RUeXBlOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJ3BpY3R1cmUtY2FyZCcKICAgIH0sCiAgICByZWFkeU9ubHk6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBoZWFkZXJzOiBudWxsLAogICAgICBiYXNlVXJsOiBwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJICsgJy9pbWFnZXMvJywKICAgICAgdXBsb2FkSW1nVXJsOiBwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJICsgIi91cGxvYWQtaW1hZ2UiLCAvLyDkuIrkvKDnmoTlm77niYfmnI3liqHlmajlnLDlnYAKICAgICAgcHJldmlld1Zpc2libGU6IGZhbHNlLAogICAgICBwcmV2aWV3SW1hZ2U6ICcnLAogICAgICBsaXN0OiBbXQogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIGZpbGVMaXN0KCkgewogICAgICBjb25zb2xlLmxvZygndGhpcy5maWxlTGlzdCcsIHRoaXMuZmlsZUxpc3QpCiAgICAgIHRoaXMuZmlsZUxpc3QuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICBpdGVtWyd1cmwnXSA9IHRoaXMuYmFzZVVybCArIGl0ZW0ubmFtZQogICAgICB9KQogICAgICB0aGlzLmxpc3QgPSB0aGlzLmZpbGVMaXN0CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBoYW5kbGVQcmV2aWV3KGZpbGUpIHsKICAgICAgdGhpcy5wcmV2aWV3SW1hZ2UgPSBmaWxlLnVybAogICAgICAvLyB0aGlzLnByZXZpZXdWaXNpYmxlID0gdHJ1ZQogICAgICBjb25zdCB1cmxzID0gW10KICAgICAgdGhpcy5saXN0LmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgdXJscy5wdXNoKGl0ZW0udXJsKQogICAgICB9KQogICAgICAvKiBjb25zdCB2Vmlld2VyID0gdGhpcy4kdmlld2VyQXBpKHsKICAgICAgICBpbWFnZXM6IHVybHMsCiAgICAgICAgdXJsOiBmaWxlLnVybAogICAgICB9KSAqLwogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5saXN0LmZpbmRJbmRleChkID0+IGQudXJsID09PSBmaWxlLnVybCkKICAgICAgICAvLyB2Vmlld2VyLnVwZGF0ZSgpLnZpZXcoaWR4KQogICAgICB9KQogICAgfSwKICAgIGhhbmRsZVVwbG9hZFN1Y2Nlc3MocmVzLCBmaWxlLCBmaWxlTGlzdCkgewogICAgICBjb25zb2xlLmxvZygncmVzLCBmaWxlJywgcmVzLCBmaWxlLCBmaWxlTGlzdCkKICAgICAgZmlsZUxpc3QuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICBpZiAoaXRlbS5yZXNwb25zZSkgewogICAgICAgICAgaXRlbVsndXJsJ10gPSB0aGlzLmJhc2VVcmwgKyBpdGVtLnJlc3BvbnNlLmZpbGVOYW1lCiAgICAgICAgICBpdGVtWyduYW1lJ10gPSBpdGVtLnJlc3BvbnNlLmZpbGVOYW1lCiAgICAgICAgfQogICAgICB9KQogICAgICB0aGlzLmxpc3QgPSBmaWxlTGlzdAogICAgICBpZiAocmVzLmNvZGUgPT09IDIwMCkgewogICAgICB9IGVsc2UgaWYgKGZpbGUuc3RhdHVzID09PSAncmVtb3ZlZCcpIHsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDlpoLkvZXlpLHotKXvvIzliKDpmaTmnIDlkI7kuIDkuKoKICAgICAgICBpZiAoIWZpbGUuYmIpIHsKICAgICAgICAgIGZpbGVMaXN0LnNwbGljZShmaWxlTGlzdC5sZW5ndGggLSAxLCAxKQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLiRlbWl0KCdsaXN0Q2hhbmdlJywgZmlsZUxpc3QpCiAgICB9LAogICAgaGFuZGxlQmVmb3JlVXBsb2FkKGZpbGUpIHsKICAgICAgY29uc3QgYmIgPSB2YWxpZGF0ZUltYWdlKGZpbGUpCiAgICAgIGZpbGVbJ2JiJ10gPSBiYgogICAgICByZXR1cm4gYmIKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/ImageUpload","sourcesContent":["<template>\n  <div class=\"component-upload-image\">\n    <el-upload\n      multiple\n      :action=\"uploadImgUrl\"\n      list-type=\"picture-card\"\n      name=\"image\"\n      :on-success=\"handleUploadSuccess\"\n      :before-upload=\"handleBeforeUpload\"\n      ref=\"imageUpload\"\n      :show-file-list=\"true\"\n      :file-list=\"fileList\"\n    >\n      <i class=\"el-icon-plus\"></i>\n    </el-upload>\n  </div>\n</template>\n\n<script>\nfunction validateImage(file) {\n  const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png' || file.type === 'image/jpg'\n  if (!isJpgOrPng) {\n    return\n  }\n  const isLt2M = file.size / 1024 / 1024 < 20 // 20M\n  if (!isLt2M) {\n    return\n  }\n  return isJpgOrPng && isLt2M\n}\nexport default {\n  name: 'ImageUpload',\n  props: {\n    // 默认列表\n    fileList: {\n      required: true,\n      type: Array\n    },\n    // 用户头像 = 》user，设备照片 =》 device，兴趣点照片 =》poi ，意见反馈照片 =》 advice\n    type: {\n      required: true,\n      type: String,\n      default: ''\n    },\n    // 限制数量\n    num: {\n      type: Number,\n      default: 6\n    },\n    listType: {\n      type: String,\n      default: 'picture-card'\n    },\n    readyOnly: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      headers: null,\n      baseUrl: process.env.VUE_APP_BASE_API + '/images/',\n      uploadImgUrl: process.env.VUE_APP_BASE_API + \"/upload-image\", // 上传的图片服务器地址\n      previewVisible: false,\n      previewImage: '',\n      list: []\n    }\n  },\n  watch: {\n    fileList() {\n      console.log('this.fileList', this.fileList)\n      this.fileList.forEach(item => {\n        item['url'] = this.baseUrl + item.name\n      })\n      this.list = this.fileList\n    }\n  },\n  methods: {\n    handlePreview(file) {\n      this.previewImage = file.url\n      // this.previewVisible = true\n      const urls = []\n      this.list.forEach(item => {\n        urls.push(item.url)\n      })\n      /* const vViewer = this.$viewerApi({\n        images: urls,\n        url: file.url\n      }) */\n      this.$nextTick(() => {\n        const idx = this.list.findIndex(d => d.url === file.url)\n        // vViewer.update().view(idx)\n      })\n    },\n    handleUploadSuccess(res, file, fileList) {\n      console.log('res, file', res, file, fileList)\n      fileList.forEach(item => {\n        if (item.response) {\n          item['url'] = this.baseUrl + item.response.fileName\n          item['name'] = item.response.fileName\n        }\n      })\n      this.list = fileList\n      if (res.code === 200) {\n      } else if (file.status === 'removed') {\n      } else {\n        // 如何失败，删除最后一个\n        if (!file.bb) {\n          fileList.splice(fileList.length - 1, 1)\n        }\n      }\n      this.$emit('listChange', fileList)\n    },\n    handleBeforeUpload(file) {\n      const bb = validateImage(file)\n      file['bb'] = bb\n      return bb\n    }\n  }\n};\n</script>\n<style scoped lang=\"scss\">\n// .el-upload--picture-card 控制加号部分\n::v-deep.hide .el-upload--picture-card {\n  display: none;\n}\n// 去掉动画效果\n::v-deep .el-list-enter-active,\n::v-deep .el-list-leave-active {\n  transition: all 0s;\n}\n\n::v-deep .el-list-enter, .el-list-leave-active {\n  opacity: 0;\n  transform: translateY(0);\n}\n</style>\n\n"]}]}