{"remainingRequest":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\babel-loader\\lib\\index.js!D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\workspace_wm\\web-ui-travel\\src\\views\\biz\\tools\\poi\\PoiPanel.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\work\\workspace_wm\\web-ui-travel\\src\\views\\biz\\tools\\poi\\PoiPanel.vue","mtime":1719891356816},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\babel.config.js","mtime":1677117676000},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkID0gcmVxdWlyZSgiRDovd29yay93b3Jrc3BhY2Vfd20vd2ViLXVpLXRyYXZlbC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkLmpzIikuZGVmYXVsdDsKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCJEOi93b3JrL3dvcmtzcGFjZV93bS93ZWItdWktdHJhdmVsL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2ludGVyb3BSZXF1aXJlRGVmYXVsdC5qcyIpLmRlZmF1bHQ7Ck9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyIpOwp2YXIgX0RyYXdQb2kgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIi4vRHJhd1BvaSIpKTsKdmFyIEZpbGVTYXZlID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgiLi9GaWxlU2F2ZSIpKTsKdmFyIF9jb21tb24gPSByZXF1aXJlKCIuLi9iaXovY29tbW9uIik7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCgp2YXIgcG9pbnRlckltZyA9IHJlcXVpcmUoJ0AvYXNzZXRzL2ltYWdlcy9sb2NhdGlvbjY0LnBuZycpOwp2YXIgZHJhd1BvaTsKdmFyIF9kZWZhdWx0ID0gewogIG5hbWU6ICdQb2lQYW5lbCcsCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGRhdGFMaXN0OiBbXSwKICAgICAgcGFnZTogJ2xpc3QnLAogICAgICBjdXJyZW50UG9pbnQ6IHsKICAgICAgICBuYW1lOiAnJwogICAgICB9LAogICAgICBmaWxlTGlzdDogW10sCiAgICAgIHBvaW50ZXJJbWc6IHBvaW50ZXJJbWcsCiAgICAgIGRyYXdpbmc6IGZhbHNlLAogICAgICBrZXlXb3JkOiAnJwogICAgfTsKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICBkcmF3UG9pID0gbmV3IF9EcmF3UG9pLmRlZmF1bHQoX3RoaXMpOwogICAgfSk7CiAgICB0aGlzLmxvYWREYXRhKCk7CiAgfSwKICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgZHJhd1BvaS5jbGVhcigpOwogICAgZHJhd1BvaS5kcmF3Q2FuY2VsKCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBsb2FkRGF0YTogZnVuY3Rpb24gbG9hZERhdGEoYykgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKICAgICAgRmlsZVNhdmUuZ2V0TGlzdCgpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIGlmIChyZXMuRGF0YSkgewogICAgICAgICAgdmFyIGxpc3QgPSByZXMuRGF0YS5saXN0OwogICAgICAgICAgaWYgKGMpIHsKICAgICAgICAgICAgYyhsaXN0KTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIHNldCBwaG90byAwCiAgICAgICAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgaXRlbS5JZCA9IGl0ZW0uSWRTdHI7CiAgICAgICAgICAgIGlmIChpdGVtLlBob3RvcykgewogICAgICAgICAgICAgIHZhciBhcnIgPSBpdGVtLlBob3Rvcy5zcGxpdCgnIycpOwogICAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgaXRlbVsncGhvdG8wJ10gPSBhcnJbMF07CiAgICAgICAgICAgICAgICBpdGVtWydwaG90b0FyciddID0gYXJyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBfdGhpczIuZGF0YUxpc3QgPSBsaXN0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczIuZGF0YUxpc3QgPSBbXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHN0YXJ0RHJhdzogZnVuY3Rpb24gc3RhcnREcmF3KCkgewogICAgICB0aGlzLmRyYXdpbmcgPSB0cnVlOwogICAgICB0aGlzLmZpbGVMaXN0ID0gW107CiAgICAgIGRyYXdQb2kuZHJhdygpOwogICAgfSwKICAgIGNhbmNlbERyYXc6IGZ1bmN0aW9uIGNhbmNlbERyYXcoKSB7CiAgICAgIGRyYXdQb2kuZHJhd0NhbmNlbCgpOwogICAgICB0aGlzLmRyYXdpbmcgPSBmYWxzZTsKICAgIH0sCiAgICBiYWNrVG9MaXN0OiBmdW5jdGlvbiBiYWNrVG9MaXN0KCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgdGhpcy5wYWdlID0gJ2xpc3QnOwogICAgICBkcmF3UG9pLmNsZWFyKCk7CiAgICAgIHRoaXMubG9hZERhdGEoZnVuY3Rpb24gKGxpc3QpIHsKICAgICAgICBpZiAoX3RoaXMzLnBvaUxheWVyU2hvdykgewogICAgICAgICAgUG9pQ29udGV4dC5nZXRMYXllcigpLnNob3cobGlzdCk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy4kcmVmcy5wb2lGb3JtLnJlc2V0RmllbGRzKCk7CiAgICB9LAogICAgc2F2ZTogZnVuY3Rpb24gc2F2ZSgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CiAgICAgIHRoaXMuJHJlZnMucG9pRm9ybS52YWxpZGF0ZShmdW5jdGlvbiAodmFsaWQpIHsKICAgICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciBjdXJyZW50UG9pbnQgPSBfdGhpczQuY3VycmVudFBvaW50OwogICAgICAgIHZhciBwYXJhbSA9IHsKICAgICAgICAgIG5hbWU6IGN1cnJlbnRQb2ludC5uYW1lLAogICAgICAgICAgdGFyZ2V0OiBjdXJyZW50UG9pbnQudGFyZ2V0LAogICAgICAgICAgbG9uZ2l0dWRlOiBjdXJyZW50UG9pbnQubG5nLAogICAgICAgICAgbGF0aXR1ZGU6IGN1cnJlbnRQb2ludC5sYXQsCiAgICAgICAgICBhbHRpdHVkZTogY3VycmVudFBvaW50LmFsdGl0dWRlIHx8IDAsCiAgICAgICAgICBwaG90b3M6ICcnLAogICAgICAgICAgYWRkcmVzczogJycsCiAgICAgICAgICBkZXNjOiBjdXJyZW50UG9pbnQuZGVzYyB8fCAnJwogICAgICAgIH07CiAgICAgICAgdmFyIHBob3RvcyA9IFtdOwogICAgICAgIGlmIChfdGhpczQuZmlsZUxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgX3RoaXM0LmZpbGVMaXN0LmZvckVhY2goZnVuY3Rpb24gKGYpIHsKICAgICAgICAgICAgcGhvdG9zLnB1c2goZi51cmwpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmIChwaG90b3MubGVuZ3RoID4gMCkgewogICAgICAgICAgcGFyYW0ucGhvdG9zID0gcGhvdG9zLmpvaW4oJyMnKTsKICAgICAgICB9CiAgICAgICAgaWYgKGN1cnJlbnRQb2ludC5pZCkgewogICAgICAgICAgcGFyYW1bJ2lkJ10gPSBjdXJyZW50UG9pbnQuaWQ7CiAgICAgICAgICBGaWxlU2F2ZS51cGRhdGUocGFyYW0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICBfdGhpczQuJG1lc3NhZ2VTdWNjZXNzKCk7CiAgICAgICAgICAgIF90aGlzNC5iYWNrVG9MaXN0KCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcGFyYW1bJ2lkJ10gPSAoMCwgX2NvbW1vbi5nZXRVdWlkKSgpOwogICAgICAgICAgX3RoaXM0LmRhdGFMaXN0LnB1c2gocGFyYW0pOwogICAgICAgICAgRmlsZVNhdmUuY3JlYXRlKF90aGlzNC5kYXRhTGlzdCkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzNC4kbWVzc2FnZVN1Y2Nlc3MoKTsKICAgICAgICAgICAgX3RoaXM0LmJhY2tUb0xpc3QoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZmx5VG86IGZ1bmN0aW9uIGZseVRvKGl0ZW0pIHsKICAgICAgZHJhd1BvaS5mbHlUbyhpdGVtKTsKICAgIH0sCiAgICBlZGl0OiBmdW5jdGlvbiBlZGl0KGl0ZW0pIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CiAgICAgIHRoaXMuZmlsZUxpc3QgPSBbXTsKICAgICAgdmFyIHBob3RvcyA9IGl0ZW0uUGhvdG9zOwogICAgICBpZiAocGhvdG9zKSB7CiAgICAgICAgdmFyIGFyciA9IHBob3Rvcy5zcGxpdCgnIycpOwogICAgICAgIGFyci5mb3JFYWNoKGZ1bmN0aW9uICh1cmwpIHsKICAgICAgICAgIF90aGlzNS5maWxlTGlzdC5wdXNoKHsKICAgICAgICAgICAgc3RhdHVzOiAnZG9uZScsCiAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICBuYW1lOiB1cmwsCiAgICAgICAgICAgIHVpZDogZ3VpZCgpCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBkcmF3UG9pLmVkaXQoaXRlbSk7CiAgICAgIC8vIFBvaUNvbnRleHQuZ2V0TGF5ZXIoKS5oaWRlKCkKICAgICAgLy8gdGhpcy5wb2lMYXllclNob3cgPSBmYWxzZQogICAgICBQb2lDb250ZXh0LmdldExheWVyKCkuY2xlYXJNYXJrZXIoaXRlbS5JZCk7CiAgICB9LAogICAgZGVsZXRlQ2xpY2s6IGZ1bmN0aW9uIGRlbGV0ZUNsaWNrKGl0ZW0pIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CiAgICAgIHRoaXMuJGNvbmZpcm1lZCh0aGlzLiR0KCdjb21tb24uZGVsZXRlMicpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcG9pLmRlbGV0ZVBvaSh7CiAgICAgICAgICBpZHM6IGl0ZW0uSWQKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIF90aGlzNi4kbWVzc2FnZVN1Y2Nlc3MoKTsKICAgICAgICAgIF90aGlzNi5sb2FkRGF0YSgpOwogICAgICAgICAgZHJhd1BvaS5jbGVhckJ5SWQoaXRlbS5JZCk7CiAgICAgICAgICBQb2lDb250ZXh0LmdldExheWVyKCkuY2xlYXJNYXJrZXIoaXRlbS5JZCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGxpc3RDaGFuZ2U6IGZ1bmN0aW9uIGxpc3RDaGFuZ2UobGlzdCkgewogICAgICB0aGlzLmZpbGVMaXN0ID0gbGlzdDsKICAgIH0sCiAgICBsYXRMbmdDaGFuZ2U6IGZ1bmN0aW9uIGxhdExuZ0NoYW5nZSh2KSB7CiAgICAgIGlmICh0aGlzLmN1cnJlbnRQb2ludC5sYXQgJiYgdGhpcy5jdXJyZW50UG9pbnQubG5nKSB7CiAgICAgICAgZHJhd1BvaS5zZXRMYXRMbmcodGhpcy5jdXJyZW50UG9pbnQubGF0LCB0aGlzLmN1cnJlbnRQb2ludC5sbmcpOwogICAgICB9CiAgICB9LAogICAgcG9pU3dpdGNoOiBmdW5jdGlvbiBwb2lTd2l0Y2goZSkgewogICAgICB0aGlzLnBvaUxheWVyU2hvdyA9IGUudGFyZ2V0LmNoZWNrZWQ7CiAgICAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgc2F2ZVJlY29yZCgn5Zyw5Zu+5Lit5p+l55yL5omA5pyJ5YW06Laj54K55YiG5biDJywgJzExJywgJzEnKTsKICAgICAgICBQb2lDb250ZXh0LmdldExheWVyKCkuc2hvdygpOwogICAgICB9IGVsc2UgewogICAgICAgIFBvaUNvbnRleHQuZ2V0TGF5ZXIoKS5oaWRlKCk7CiAgICAgIH0KICAgIH0KICB9Cn07CmV4cG9ydHMuZGVmYXVsdCA9IF9kZWZhdWx0Ow=="},{"version":3,"names":["_DrawPoi","_interopRequireDefault","require","FileSave","_interopRequireWildcard","_common","pointerImg","drawPoi","_default","name","data","dataList","page","currentPoint","fileList","drawing","keyWord","mounted","_this","$nextTick","DrawPoi","loadData","beforeDestroy","clear","drawCancel","methods","c","_this2","getList","then","res","Data","list","forEach","item","Id","IdStr","Photos","arr","split","length","startDraw","draw","cancelDraw","backToList","_this3","poiLayerShow","PoiContext","getLayer","show","$refs","poiForm","resetFields","save","_this4","validate","valid","param","target","longitude","lng","latitude","lat","altitude","photos","address","desc","f","push","url","join","id","update","$messageSuccess","getUuid","create","flyTo","edit","_this5","status","uid","guid","clearMarker","deleteClick","_this6","$confirmed","$t","poi","deletePoi","ids","clearById","listChange","latLngChange","v","setLatLng","poiSwitch","e","checked","saveRecord","hide","exports","default"],"sources":["src/views/biz/tools/poi/PoiPanel.vue"],"sourcesContent":["<template>\n  <div style=\"overflow: auto;width: 300px;background: white;\">\n    <div v-show=\"page == 'list'\" class=\"poiPage\">\n      <section style=\"margin: 0 20px;color:black;\">\n        <div style=\"width: 100%;line-height:30px;color: #606266;\">\n          <el-checkbox :checked=\"poiLayerShow\" style=\"line-height: 30px;\" @change=\"poiSwitch\">\n            列表\n          </el-checkbox>\n          <div v-show=\"dataList.length>0\" style=\"float: right;\">\n            <el-button v-if=\"!drawing\" type=\"link\" @click=\"startDraw\">\n              <i class=\"iconfont icon-jia-line\" /> 标绘\n            </el-button>\n            <el-button v-if=\"drawing\" type=\"link\" @click=\"cancelDraw\">\n              取消\n            </el-button>\n          </div>\n        </div>\n        <div style=\"clear: right;\">\n          <el-input-search\n            v-model=\"keyWord\"\n            placeholder=\"搜索\"\n            style=\"width:350px;margin-top: 10px;\"\n            allow-clear\n            enter-button\n            @pressEnter=\"loadData\"\n            @search=\"loadData\"\n          />\n        </div>\n      </section>\n      <section style=\"margin: 20px;color:black;\">\n        <el-empty v-show=\"dataList.length<1\" style=\"color: #606266;margin-top: 20px;padding-top: 120px;height:calc(100vh - 100px)\">\n          <span slot=\"description\"> 无数据 </span>\n          <el-button v-if=\"!drawing\" type=\"primary\" @click=\"startDraw\">\n            <i class=\"iconfont icon-jia-line\" /> 标绘\n          </el-button>\n          <el-button v-if=\"drawing\" type=\"primary\" @click=\"cancelDraw\">\n            取消\n          </el-button>\n        </el-empty>\n        <a-list v-show=\"dataList.length > 0\" item-layout=\"horizontal\" :data-source=\"dataList\" :style=\"{ height: 'calc(100vh - 240px)',overflow: 'auto' }\">\n          <a-list-item slot=\"renderItem\" slot-scope=\"item\">\n            <el-button slot=\"actions\" type=\"link\" class=\"btn-link\" ghost @click=\"edit(item)\">编辑</el-button>\n            <el-button slot=\"actions\" type=\"link\" class=\"btn-link hover-red\" ghost @click=\"deleteClick(item)\">删除</el-button>\n            <a-list-item-meta>\n              <span slot=\"description\">\n                <div style=\"width: 170px;\">\n                  <span class=\"tableColum\"> {{ item.Description }}</span>\n                </div>\n              </span>\n              <a\n                slot=\"title\"\n                :title=\"item.Name\"\n                @click=\"flyTo(item)\"\n              >\n                <div style=\"width: 190px;\">\n                  <span class=\"tableColum\"> {{ item.Name }}</span>\n                </div>\n              </a>\n              <a-avatar v-if=\"item.photo0\" slot=\"avatar\" class=\"poiImg\" :src=\"item.photo0\" />\n              <a-avatar v-else slot=\"avatar\" class=\"poiImg\" :src=\"pointerImg\" />\n            </a-list-item-meta>\n          </a-list-item>\n        </a-list>\n      </section>\n    </div>\n    <div v-show=\"page == 'edit'\">\n      <div style=\"padding: 20px;max-height: calc(100vh - 130px);overflow: auto;\">\n        <el-form\n          ref=\"poiForm\"\n          :model=\"currentPoint\"\n          :label-col=\"{ span: 6 }\"\n          :wrapper-col=\"{ span: 18 }\"\n        >\n          <el-form-item prop=\"name\" label=\"名称\">\n            <el-input v-model=\"currentPoint.name\" allow-clear />\n          </el-form-item>\n          <el-form-item label=\"目的地\">\n            <el-input v-model=\"currentPoint.target\" allow-clear />\n          </el-form-item>\n          <el-form-item label=\"x\">\n            <el-input-number v-model=\"currentPoint.lng\" :min=\"-180\" :max=\"180\" style=\"width: 270px;\" @change=\"latLngChange\" />\n          </el-form-item>\n          <el-form-item label=\"y\">\n            <el-input-number v-model=\"currentPoint.lat\" :min=\"-90\" :max=\"90\" style=\"width: 270px;\" @change=\"latLngChange\" />\n          </el-form-item>\n          <el-form-item label=\"描述\" style=\"margin-bottom: 0;\">\n            <el-textarea\n              v-model=\"currentPoint.desc\"\n              :auto-size=\"{ minRows: 3, maxRows: 5 }\"\n              allow-clear\n            />\n          </el-form-item>\n          <el-form-item\n            label=\"图片\"\n            :label-col=\"{ }\"\n            :wrapper-col=\"{ }\"\n            style=\"margin-bottom: 0;\"\n          >\n            <image-upload :file-list=\"fileList\" type=\"poi\" @listChange=\"listChange\" />\n          </el-form-item>\n        </el-form>\n        <div style=\"width: 100%;\">\n          <el-button @click=\"backToList\">\n            <a-icon type=\"caret-left\" /> 返回\n          </el-button>\n          <div style=\"float: right;\">\n            <el-button style=\"margin-left: 10px;\" type=\"primary\" @click=\"save\">确定</el-button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport DrawPoi from './DrawPoi'\nconst pointerImg = require('@/assets/images/location64.png')\nimport * as FileSave from './FileSave'\nimport { getUuid } from '../biz/common'\n\nlet drawPoi\nexport default {\n  name: 'PoiPanel',\n  data() {\n    return {\n      dataList: [],\n      page: 'list',\n      currentPoint: {\n        name: ''\n      },\n      fileList: [],\n      pointerImg: pointerImg,\n      drawing: false,\n      keyWord: ''\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {\n      drawPoi = new DrawPoi(this)\n    })\n    this.loadData()\n  },\n  beforeDestroy() {\n    drawPoi.clear()\n    drawPoi.drawCancel()\n  },\n  methods: {\n    loadData(c) {\n      FileSave.getList().then(res => {\n        if (res.Data) {\n          const list = res.Data.list\n          if (c) {\n            c(list)\n          }\n          // set photo 0\n          list.forEach(item => {\n            item.Id = item.IdStr\n            if (item.Photos) {\n              const arr = item.Photos.split('#')\n              if (arr.length > 0) {\n                item['photo0'] = arr[0]\n                item['photoArr'] = arr\n              }\n            }\n          })\n          this.dataList = list\n        } else {\n          this.dataList = []\n        }\n      })\n    },\n    startDraw() {\n      this.drawing = true\n      this.fileList = []\n      drawPoi.draw()\n    },\n    cancelDraw() {\n      drawPoi.drawCancel()\n      this.drawing = false\n    },\n    backToList() {\n      this.page = 'list'\n      drawPoi.clear()\n      this.loadData(list => {\n        if (this.poiLayerShow) {\n          PoiContext.getLayer().show(list)\n        }\n      })\n      this.$refs.poiForm.resetFields()\n    },\n    save() {\n      this.$refs.poiForm.validate(valid => {\n        if (!valid) {\n          return\n        }\n        const currentPoint = this.currentPoint\n\n        const param = {\n          name: currentPoint.name,\n          target: currentPoint.target,\n          longitude: currentPoint.lng,\n          latitude: currentPoint.lat,\n          altitude: currentPoint.altitude || 0,\n          photos: '',\n          address: '',\n          desc: currentPoint.desc || ''\n        }\n        const photos = []\n        if (this.fileList.length > 0) {\n          this.fileList.forEach(f => {\n            photos.push(f.url)\n          })\n        }\n        if (photos.length > 0) {\n          param.photos = photos.join('#')\n        }\n\n        if (currentPoint.id) {\n          param['id'] = currentPoint.id\n          FileSave.update(param).then(res => {\n            this.$messageSuccess()\n            this.backToList()\n          })\n        } else {\n          param['id'] = getUuid()\n          this.dataList.push(param)\n          FileSave.create(this.dataList).then(res => {\n            this.$messageSuccess()\n            this.backToList()\n          })\n        }\n      })\n    },\n    flyTo(item) {\n      drawPoi.flyTo(item)\n    },\n    edit(item) {\n      this.fileList = []\n      const photos = item.Photos\n      if (photos) {\n        const arr = photos.split('#')\n        arr.forEach(url => {\n          this.fileList.push({\n            status: 'done',\n            url: url,\n            name: url,\n            uid: guid()\n          })\n        })\n      }\n      drawPoi.edit(item)\n      // PoiContext.getLayer().hide()\n      // this.poiLayerShow = false\n      PoiContext.getLayer().clearMarker(item.Id)\n    },\n    deleteClick(item) {\n      this.$confirmed(this.$t('common.delete2'), () => {\n        poi.deletePoi({\n          ids: item.Id\n        }).then(res => {\n          this.$messageSuccess()\n          this.loadData()\n          drawPoi.clearById(item.Id)\n          PoiContext.getLayer().clearMarker(item.Id)\n        })\n      })\n    },\n    listChange(list) {\n      this.fileList = list\n    },\n    latLngChange(v) {\n      if (this.currentPoint.lat && this.currentPoint.lng) {\n        drawPoi.setLatLng(this.currentPoint.lat, this.currentPoint.lng)\n      }\n    },\n    poiSwitch(e) {\n      this.poiLayerShow = e.target.checked\n      if (e.target.checked) {\n        saveRecord('地图中查看所有兴趣点分布', '11', '1')\n        PoiContext.getLayer().show()\n      } else {\n        PoiContext.getLayer().hide()\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n\n.poiImg {\n  width: 40px;\n  height: 40px;\n  border-radius: 5px;\n}\n</style>\n"],"mappings":";;;;;;;;;;;;;AAmHA,IAAAA,QAAA,GAAAC,sBAAA,CAAAC,OAAA;AAEA,IAAAC,QAAA,GAAAC,uBAAA,CAAAF,OAAA;AACA,IAAAG,OAAA,GAAAH,OAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAFA,IAAAI,UAAA,GAAAJ,OAAA;AAIA,IAAAK,OAAA;AAAA,IAAAC,QAAA,GACA;EACAC,IAAA;EACAC,IAAA,WAAAA,KAAA;IACA;MACAC,QAAA;MACAC,IAAA;MACAC,YAAA;QACAJ,IAAA;MACA;MACAK,QAAA;MACAR,UAAA,EAAAA,UAAA;MACAS,OAAA;MACAC,OAAA;IACA;EACA;EACAC,OAAA,WAAAA,QAAA;IAAA,IAAAC,KAAA;IACA,KAAAC,SAAA;MACAZ,OAAA,OAAAa,gBAAA,CAAAF,KAAA;IACA;IACA,KAAAG,QAAA;EACA;EACAC,aAAA,WAAAA,cAAA;IACAf,OAAA,CAAAgB,KAAA;IACAhB,OAAA,CAAAiB,UAAA;EACA;EACAC,OAAA;IACAJ,QAAA,WAAAA,SAAAK,CAAA;MAAA,IAAAC,MAAA;MACAxB,QAAA,CAAAyB,OAAA,GAAAC,IAAA,WAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACA,IAAAC,IAAA,GAAAF,GAAA,CAAAC,IAAA,CAAAC,IAAA;UACA,IAAAN,CAAA;YACAA,CAAA,CAAAM,IAAA;UACA;UACA;UACAA,IAAA,CAAAC,OAAA,WAAAC,IAAA;YACAA,IAAA,CAAAC,EAAA,GAAAD,IAAA,CAAAE,KAAA;YACA,IAAAF,IAAA,CAAAG,MAAA;cACA,IAAAC,GAAA,GAAAJ,IAAA,CAAAG,MAAA,CAAAE,KAAA;cACA,IAAAD,GAAA,CAAAE,MAAA;gBACAN,IAAA,aAAAI,GAAA;gBACAJ,IAAA,eAAAI,GAAA;cACA;YACA;UACA;UACAX,MAAA,CAAAhB,QAAA,GAAAqB,IAAA;QACA;UACAL,MAAA,CAAAhB,QAAA;QACA;MACA;IACA;IACA8B,SAAA,WAAAA,UAAA;MACA,KAAA1B,OAAA;MACA,KAAAD,QAAA;MACAP,OAAA,CAAAmC,IAAA;IACA;IACAC,UAAA,WAAAA,WAAA;MACApC,OAAA,CAAAiB,UAAA;MACA,KAAAT,OAAA;IACA;IACA6B,UAAA,WAAAA,WAAA;MAAA,IAAAC,MAAA;MACA,KAAAjC,IAAA;MACAL,OAAA,CAAAgB,KAAA;MACA,KAAAF,QAAA,WAAAW,IAAA;QACA,IAAAa,MAAA,CAAAC,YAAA;UACAC,UAAA,CAAAC,QAAA,GAAAC,IAAA,CAAAjB,IAAA;QACA;MACA;MACA,KAAAkB,KAAA,CAAAC,OAAA,CAAAC,WAAA;IACA;IACAC,IAAA,WAAAA,KAAA;MAAA,IAAAC,MAAA;MACA,KAAAJ,KAAA,CAAAC,OAAA,CAAAI,QAAA,WAAAC,KAAA;QACA,KAAAA,KAAA;UACA;QACA;QACA,IAAA3C,YAAA,GAAAyC,MAAA,CAAAzC,YAAA;QAEA,IAAA4C,KAAA;UACAhD,IAAA,EAAAI,YAAA,CAAAJ,IAAA;UACAiD,MAAA,EAAA7C,YAAA,CAAA6C,MAAA;UACAC,SAAA,EAAA9C,YAAA,CAAA+C,GAAA;UACAC,QAAA,EAAAhD,YAAA,CAAAiD,GAAA;UACAC,QAAA,EAAAlD,YAAA,CAAAkD,QAAA;UACAC,MAAA;UACAC,OAAA;UACAC,IAAA,EAAArD,YAAA,CAAAqD,IAAA;QACA;QACA,IAAAF,MAAA;QACA,IAAAV,MAAA,CAAAxC,QAAA,CAAA0B,MAAA;UACAc,MAAA,CAAAxC,QAAA,CAAAmB,OAAA,WAAAkC,CAAA;YACAH,MAAA,CAAAI,IAAA,CAAAD,CAAA,CAAAE,GAAA;UACA;QACA;QACA,IAAAL,MAAA,CAAAxB,MAAA;UACAiB,KAAA,CAAAO,MAAA,GAAAA,MAAA,CAAAM,IAAA;QACA;QAEA,IAAAzD,YAAA,CAAA0D,EAAA;UACAd,KAAA,SAAA5C,YAAA,CAAA0D,EAAA;UACApE,QAAA,CAAAqE,MAAA,CAAAf,KAAA,EAAA5B,IAAA,WAAAC,GAAA;YACAwB,MAAA,CAAAmB,eAAA;YACAnB,MAAA,CAAAV,UAAA;UACA;QACA;UACAa,KAAA,aAAAiB,eAAA;UACApB,MAAA,CAAA3C,QAAA,CAAAyD,IAAA,CAAAX,KAAA;UACAtD,QAAA,CAAAwE,MAAA,CAAArB,MAAA,CAAA3C,QAAA,EAAAkB,IAAA,WAAAC,GAAA;YACAwB,MAAA,CAAAmB,eAAA;YACAnB,MAAA,CAAAV,UAAA;UACA;QACA;MACA;IACA;IACAgC,KAAA,WAAAA,MAAA1C,IAAA;MACA3B,OAAA,CAAAqE,KAAA,CAAA1C,IAAA;IACA;IACA2C,IAAA,WAAAA,KAAA3C,IAAA;MAAA,IAAA4C,MAAA;MACA,KAAAhE,QAAA;MACA,IAAAkD,MAAA,GAAA9B,IAAA,CAAAG,MAAA;MACA,IAAA2B,MAAA;QACA,IAAA1B,GAAA,GAAA0B,MAAA,CAAAzB,KAAA;QACAD,GAAA,CAAAL,OAAA,WAAAoC,GAAA;UACAS,MAAA,CAAAhE,QAAA,CAAAsD,IAAA;YACAW,MAAA;YACAV,GAAA,EAAAA,GAAA;YACA5D,IAAA,EAAA4D,GAAA;YACAW,GAAA,EAAAC,IAAA;UACA;QACA;MACA;MACA1E,OAAA,CAAAsE,IAAA,CAAA3C,IAAA;MACA;MACA;MACAa,UAAA,CAAAC,QAAA,GAAAkC,WAAA,CAAAhD,IAAA,CAAAC,EAAA;IACA;IACAgD,WAAA,WAAAA,YAAAjD,IAAA;MAAA,IAAAkD,MAAA;MACA,KAAAC,UAAA,MAAAC,EAAA;QACAC,GAAA,CAAAC,SAAA;UACAC,GAAA,EAAAvD,IAAA,CAAAC;QACA,GAAAN,IAAA,WAAAC,GAAA;UACAsD,MAAA,CAAAX,eAAA;UACAW,MAAA,CAAA/D,QAAA;UACAd,OAAA,CAAAmF,SAAA,CAAAxD,IAAA,CAAAC,EAAA;UACAY,UAAA,CAAAC,QAAA,GAAAkC,WAAA,CAAAhD,IAAA,CAAAC,EAAA;QACA;MACA;IACA;IACAwD,UAAA,WAAAA,WAAA3D,IAAA;MACA,KAAAlB,QAAA,GAAAkB,IAAA;IACA;IACA4D,YAAA,WAAAA,aAAAC,CAAA;MACA,SAAAhF,YAAA,CAAAiD,GAAA,SAAAjD,YAAA,CAAA+C,GAAA;QACArD,OAAA,CAAAuF,SAAA,MAAAjF,YAAA,CAAAiD,GAAA,OAAAjD,YAAA,CAAA+C,GAAA;MACA;IACA;IACAmC,SAAA,WAAAA,UAAAC,CAAA;MACA,KAAAlD,YAAA,GAAAkD,CAAA,CAAAtC,MAAA,CAAAuC,OAAA;MACA,IAAAD,CAAA,CAAAtC,MAAA,CAAAuC,OAAA;QACAC,UAAA;QACAnD,UAAA,CAAAC,QAAA,GAAAC,IAAA;MACA;QACAF,UAAA,CAAAC,QAAA,GAAAmD,IAAA;MACA;IACA;EACA;AACA;AAAAC,OAAA,CAAAC,OAAA,GAAA7F,QAAA"}]}