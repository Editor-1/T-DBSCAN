{"remainingRequest":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\babel-loader\\lib\\index.js!D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\workspace_wm\\web-ui-travel\\src\\views\\biz\\tools\\poi\\PoiPanel.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\work\\workspace_wm\\web-ui-travel\\src\\views\\biz\\tools\\poi\\PoiPanel.vue","mtime":1720084335744},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\babel.config.js","mtime":1677117676000},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkID0gcmVxdWlyZSgiRDovd29yay93b3Jrc3BhY2Vfd20vd2ViLXVpLXRyYXZlbC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkLmpzIikuZGVmYXVsdDsKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCJEOi93b3JrL3dvcmtzcGFjZV93bS93ZWItdWktdHJhdmVsL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2ludGVyb3BSZXF1aXJlRGVmYXVsdC5qcyIpLmRlZmF1bHQ7Ck9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC1pbmRleC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlLmpzIik7CnZhciBfRHJhd1BvaSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiLi9EcmF3UG9pIikpOwp2YXIgRmlsZVNhdmUgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCIuL0ZpbGVTYXZlIikpOwp2YXIgX2NvbW1vbiA9IHJlcXVpcmUoIi4uL2Jpei9jb21tb24iKTsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCnZhciBwb2ludGVySW1nID0gcmVxdWlyZSgnQC9hc3NldHMvaW1hZ2VzL2xvY2F0aW9uNjQucG5nJyk7CnZhciBkcmF3UG9pOwp2YXIgX2RlZmF1bHQgPSB7CiAgbmFtZTogJ1BvaVBhbmVsJywKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGF0YUxpc3Q6IFtdLAogICAgICBwYWdlOiAnbGlzdCcsCiAgICAgIGN1cnJlbnRQb2ludDogewogICAgICAgIG5hbWU6ICcnLAogICAgICAgIHRpbWU6ICcnCiAgICAgIH0sCiAgICAgIGZpbGVMaXN0OiBbXSwKICAgICAgcG9pbnRlckltZzogcG9pbnRlckltZywKICAgICAgZHJhd2luZzogZmFsc2UsCiAgICAgIGtleVdvcmQ6ICcnCiAgICB9OwogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgIGRyYXdQb2kgPSBuZXcgX0RyYXdQb2kuZGVmYXVsdChfdGhpcyk7CiAgICB9KTsKICAgIHRoaXMubG9hZERhdGEoKTsKICB9LAogIGJlZm9yZURlc3Ryb3k6IGZ1bmN0aW9uIGJlZm9yZURlc3Ryb3koKSB7CiAgICBkcmF3UG9pLmNsZWFyKCk7CiAgICBkcmF3UG9pLmRyYXdDYW5jZWwoKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGxvYWREYXRhOiBmdW5jdGlvbiBsb2FkRGF0YSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgIEZpbGVTYXZlLmdldExpc3QoKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBjb25zb2xlLmxvZygncmVzJywgcmVzKTsKICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICB2YXIgbGlzdCA9IHJlczsKICAgICAgICAgIC8vIHNldCBwaG90byAwCiAgICAgICAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgaWYgKGl0ZW0ucGhvdG9zKSB7CiAgICAgICAgICAgICAgdmFyIGFyciA9IGl0ZW0ucGhvdG9zLnNwbGl0KCcjJyk7CiAgICAgICAgICAgICAgaWYgKGFyci5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBpdGVtWydwaG90bzAnXSA9IGFyclswXTsKICAgICAgICAgICAgICAgIGl0ZW1bJ3Bob3RvQXJyJ10gPSBhcnI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIF90aGlzMi5kYXRhTGlzdCA9IGxpc3Q7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzMi5kYXRhTGlzdCA9IFtdOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc3RhcnREcmF3OiBmdW5jdGlvbiBzdGFydERyYXcoKSB7CiAgICAgIHRoaXMuZHJhd2luZyA9IHRydWU7CiAgICAgIHRoaXMuZmlsZUxpc3QgPSBbXTsKICAgICAgZHJhd1BvaS5kcmF3KCk7CiAgICB9LAogICAgY2FuY2VsRHJhdzogZnVuY3Rpb24gY2FuY2VsRHJhdygpIHsKICAgICAgZHJhd1BvaS5kcmF3Q2FuY2VsKCk7CiAgICAgIHRoaXMuZHJhd2luZyA9IGZhbHNlOwogICAgfSwKICAgIGJhY2tUb0xpc3Q6IGZ1bmN0aW9uIGJhY2tUb0xpc3QoKSB7CiAgICAgIHRoaXMucGFnZSA9ICdsaXN0JzsKICAgICAgZHJhd1BvaS5jbGVhcigpOwogICAgICB0aGlzLiRyZWZzLnBvaUZvcm0ucmVzZXRGaWVsZHMoKTsKICAgIH0sCiAgICBzYXZlOiBmdW5jdGlvbiBzYXZlKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgdGhpcy4kcmVmcy5wb2lGb3JtLnZhbGlkYXRlKGZ1bmN0aW9uICh2YWxpZCkgewogICAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIGN1cnJlbnRQb2ludCA9IF90aGlzMy5jdXJyZW50UG9pbnQ7CiAgICAgICAgdmFyIHBhcmFtID0gewogICAgICAgICAgbmFtZTogY3VycmVudFBvaW50Lm5hbWUsCiAgICAgICAgICB0aW1lOiBjdXJyZW50UG9pbnQudGltZSwKICAgICAgICAgIGxvbmdpdHVkZTogY3VycmVudFBvaW50LmxuZywKICAgICAgICAgIGxhdGl0dWRlOiBjdXJyZW50UG9pbnQubGF0LAogICAgICAgICAgYWx0aXR1ZGU6IGN1cnJlbnRQb2ludC5hbHRpdHVkZSB8fCAwLAogICAgICAgICAgcGhvdG9zOiAnJywKICAgICAgICAgIGFkZHJlc3M6ICcnLAogICAgICAgICAgZGVzYzogY3VycmVudFBvaW50LmRlc2MgfHwgJycKICAgICAgICB9OwogICAgICAgIHZhciBwaG90b3MgPSBbXTsKICAgICAgICBjb25zb2xlLmxvZygndGhpcy5maWxlTGlzdCcsIF90aGlzMy5maWxlTGlzdCk7CiAgICAgICAgaWYgKF90aGlzMy5maWxlTGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICBfdGhpczMuZmlsZUxpc3QuZm9yRWFjaChmdW5jdGlvbiAoZikgewogICAgICAgICAgICBwaG90b3MucHVzaChmLm5hbWUpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmIChwaG90b3MubGVuZ3RoID4gMCkgewogICAgICAgICAgcGFyYW0ucGhvdG9zID0gcGhvdG9zLmpvaW4oJyMnKTsKICAgICAgICB9CiAgICAgICAgaWYgKGN1cnJlbnRQb2ludC5pZCkgewogICAgICAgICAgdmFyIGl0ZW0gPSBfdGhpczMuZGF0YUxpc3QuZmluZChmdW5jdGlvbiAoZCkgewogICAgICAgICAgICByZXR1cm4gZC5pZCA9PT0gY3VycmVudFBvaW50LmlkOwogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICBpdGVtLm5hbWUgPSBjdXJyZW50UG9pbnQubmFtZSB8fCAnJzsKICAgICAgICAgICAgaXRlbS50aW1lID0gY3VycmVudFBvaW50LnRpbWUgfHwgJyc7CiAgICAgICAgICAgIGl0ZW0ubG9uZ2l0dWRlID0gY3VycmVudFBvaW50LmxuZzsKICAgICAgICAgICAgaXRlbS5sYXRpdHVkZSA9IGN1cnJlbnRQb2ludC5sYXQ7CiAgICAgICAgICAgIGl0ZW0uYWx0aXR1ZGUgPSBjdXJyZW50UG9pbnQuYWx0aXR1ZGUgfHwgMCwgaXRlbS5waG90b3MgPSBwYXJhbS5waG90b3M7CiAgICAgICAgICAgIGl0ZW0uYWRkcmVzcyA9IHBhcmFtLmFkZHJlc3M7CiAgICAgICAgICAgIGl0ZW0uZGVzYyA9IGN1cnJlbnRQb2ludC5kZXNjIHx8ICcnOwogICAgICAgICAgICBGaWxlU2F2ZS5jcmVhdGUoX3RoaXMzLmRhdGFMaXN0KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICBfdGhpczMuJG1lc3NhZ2VTdWNjZXNzKCk7CiAgICAgICAgICAgICAgX3RoaXMzLmJhY2tUb0xpc3QoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBhcmFtWydpZCddID0gKDAsIF9jb21tb24uZ2V0VXVpZCkoKTsKICAgICAgICAgIF90aGlzMy5kYXRhTGlzdC5wdXNoKHBhcmFtKTsKICAgICAgICAgIEZpbGVTYXZlLmNyZWF0ZShfdGhpczMuZGF0YUxpc3QpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICBfdGhpczMuJG1lc3NhZ2VTdWNjZXNzKCk7CiAgICAgICAgICAgIF90aGlzMy5iYWNrVG9MaXN0KCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGZseVRvOiBmdW5jdGlvbiBmbHlUbyhpdGVtKSB7CiAgICAgIGRyYXdQb2kuZmx5VG8oaXRlbSk7CiAgICB9LAogICAgZWRpdDogZnVuY3Rpb24gZWRpdChpdGVtKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwogICAgICB0aGlzLmZpbGVMaXN0ID0gW107CiAgICAgIHZhciBwaG90b3MgPSBpdGVtLnBob3RvczsKICAgICAgaWYgKHBob3RvcykgewogICAgICAgIHZhciBhcnIgPSBwaG90b3Muc3BsaXQoJyMnKTsKICAgICAgICBhcnIuZm9yRWFjaChmdW5jdGlvbiAodXJsKSB7CiAgICAgICAgICBfdGhpczQuZmlsZUxpc3QucHVzaCh7CiAgICAgICAgICAgIHN0YXR1czogJ2RvbmUnLAogICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgbmFtZTogdXJsLAogICAgICAgICAgICB1aWQ6ICgwLCBfY29tbW9uLmdldFV1aWQpKCkKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGRyYXdQb2kuZWRpdChpdGVtKTsKICAgIH0sCiAgICBkZWxldGVDbGljazogZnVuY3Rpb24gZGVsZXRlQ2xpY2soaXRlbSkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKICAgICAgdmFyIGlkeCA9IHRoaXMuZGF0YUxpc3QuZmluZEluZGV4KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgcmV0dXJuIGQuaWQgPT09IGl0ZW0uaWQ7CiAgICAgIH0pOwogICAgICB0aGlzLmRhdGFMaXN0LnNwbGljZShpZHgsIDEpOwogICAgICBGaWxlU2F2ZS5jcmVhdGUodGhpcy5kYXRhTGlzdCkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXM1LiRtZXNzYWdlU3VjY2VzcygpOwogICAgICAgIF90aGlzNS5sb2FkRGF0YSgpOwogICAgICAgIGRyYXdQb2kuY2xlYXJCeUlkKGl0ZW0uaWQpOwogICAgICB9KTsKICAgIH0sCiAgICBsaXN0Q2hhbmdlOiBmdW5jdGlvbiBsaXN0Q2hhbmdlKGxpc3QpIHsKICAgICAgdGhpcy5maWxlTGlzdCA9IGxpc3Q7CiAgICB9LAogICAgbGF0TG5nQ2hhbmdlOiBmdW5jdGlvbiBsYXRMbmdDaGFuZ2UodikgewogICAgICBpZiAodGhpcy5jdXJyZW50UG9pbnQubGF0ICYmIHRoaXMuY3VycmVudFBvaW50LmxuZykgewogICAgICAgIGRyYXdQb2kuc2V0TGF0TG5nKHRoaXMuY3VycmVudFBvaW50LmxhdCwgdGhpcy5jdXJyZW50UG9pbnQubG5nKTsKICAgICAgfQogICAgfSwKICAgIHBvaVN3aXRjaDogZnVuY3Rpb24gcG9pU3dpdGNoKGUpIHsKICAgICAgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICBzYXZlUmVjb3JkKCflnLDlm77kuK3mn6XnnIvmiYDmnInlhbTotqPngrnliIbluIMnLCAnMTEnLCAnMScpOwogICAgICAgIFBvaUNvbnRleHQuZ2V0TGF5ZXIoKS5zaG93KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgUG9pQ29udGV4dC5nZXRMYXllcigpLmhpZGUoKTsKICAgICAgfQogICAgfQogIH0KfTsKZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7"},{"version":3,"names":["_DrawPoi","_interopRequireDefault","require","FileSave","_interopRequireWildcard","_common","pointerImg","drawPoi","_default","name","data","dataList","page","currentPoint","time","fileList","drawing","keyWord","mounted","_this","$nextTick","DrawPoi","loadData","beforeDestroy","clear","drawCancel","methods","_this2","getList","then","res","console","log","list","forEach","item","photos","arr","split","length","startDraw","draw","cancelDraw","backToList","$refs","poiForm","resetFields","save","_this3","validate","valid","param","longitude","lng","latitude","lat","altitude","address","desc","f","push","join","id","find","d","create","$messageSuccess","getUuid","flyTo","edit","_this4","url","status","uid","deleteClick","_this5","idx","findIndex","splice","clearById","listChange","latLngChange","v","setLatLng","poiSwitch","e","target","checked","saveRecord","PoiContext","getLayer","show","hide","exports","default"],"sources":["src/views/biz/tools/poi/PoiPanel.vue"],"sourcesContent":["<template>\n  <div style=\"overflow: auto;width: 260px;background: white;\">\n    <div v-show=\"page == 'list'\" class=\"poiPage\" style=\"margin-top: 10px;\">\n      <section style=\"margin: 0 20px;color:black;\">\n        <div style=\"width: 100%;line-height:30px;color: #606266;\">\n          <el-checkbox style=\"line-height: 30px;\" @change=\"poiSwitch\">\n            全部\n          </el-checkbox>\n          <div v-show=\"dataList.length>0\" style=\"float: right;\">\n            <el-button v-if=\"!drawing\" type=\"link\" @click=\"startDraw\">\n              <i class=\"iconfont icon-jia-line\" /> 标绘\n            </el-button>\n            <el-button v-if=\"drawing\" type=\"link\" @click=\"cancelDraw\">\n              取消\n            </el-button>\n          </div>\n        </div>\n        <div style=\"clear: right;\">\n          <el-input\n            v-model=\"keyWord\"\n            placeholder=\"搜索\"\n            style=\"width:220px;margin-top: 10px;\"\n            allow-clear\n            enter-button\n            @pressEnter=\"loadData\"\n            @search=\"loadData\"\n          />\n        </div>\n      </section>\n      <section style=\"margin: 20px;color:black;\">\n        <el-empty v-show=\"dataList.length<1\" style=\"color: #606266;margin-top: 20px;padding-top: 120px;height:calc(100vh - 100px)\">\n          <span slot=\"description\"> 无数据 </span>\n          <el-button v-if=\"!drawing\" type=\"link\" @click=\"startDraw\">\n            <i class=\"iconfont icon-jia-line\" /> 标绘\n          </el-button>\n          <el-button v-if=\"drawing\" type=\"primary\" @click=\"cancelDraw\">\n            取消\n          </el-button>\n        </el-empty>\n        <div v-show=\"dataList.length > 0\" item-layout=\"horizontal\" :data-source=\"dataList\" :style=\"{ height: 'calc(100vh - 240px)',overflow: 'auto' }\">\n          <div v-for=\"item in dataList\">\n            <div style=\"line-height: 32px;border-bottom: 1px solid #d3e1f5;\">\n              {{ item.name }}\n              <div style=\"float: right;\">\n\n                <el-button slot=\"actions\" type=\"text\" class=\"btn-link\" ghost @click=\"edit(item)\">编辑</el-button>\n                <el-button slot=\"actions\" type=\"text\" class=\"btn-link hover-red\" ghost @click=\"deleteClick(item)\">删除</el-button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n    </div>\n    <div v-show=\"page == 'edit'\">\n      <div style=\"padding: 20px;max-height: calc(100vh - 130px);overflow: auto;\">\n        <el-form ref=\"poiForm\" :model=\"currentPoint\" size=\"small\">\n          <el-form-item prop=\"name\" label=\"名称\">\n            <el-input v-model=\"currentPoint.name\" allow-clear />\n          </el-form-item>\n          <el-form-item prop=\"name\" label=\"时间\">\n            <el-input v-model=\"currentPoint.time\" allow-clear />\n          </el-form-item>\n          <el-form-item label=\"x\">\n            <el-input v-model=\"currentPoint.lng\" :min=\"-180\" :max=\"180\" @change=\"latLngChange\" />\n          </el-form-item>\n          <el-form-item label=\"y\">\n            <el-input v-model=\"currentPoint.lat\" :min=\"-90\" :max=\"90\" @change=\"latLngChange\" />\n          </el-form-item>\n          <el-form-item label=\"描述\" style=\"margin-bottom: 0;\">\n            <el-input v-model=\"currentPoint.desc\" type=\"textarea\" />\n          </el-form-item>\n          <el-form-item\n            label=\"图片\"\n            style=\"margin-top: 10px;\"\n          >\n            <image-upload :fileList=\"fileList\" type=\"poi\" @listChange=\"listChange\" />\n          </el-form-item>\n        </el-form>\n        <div style=\"width: 100%;\">\n          <el-button @click=\"backToList\">\n            返回\n            </el-button>\n            <div style=\"float: right;\">\n              <el-button style=\"margin-left: 10px;\" type=\"primary\" @click=\"save\">确定</el-button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport DrawPoi from './DrawPoi'\nconst pointerImg = require('@/assets/images/location64.png')\nimport * as FileSave from './FileSave'\nimport { getUuid } from '../biz/common'\n\nlet drawPoi\nexport default {\n  name: 'PoiPanel',\n  data() {\n    return {\n      dataList: [],\n      page: 'list',\n      currentPoint: {\n        name: '',\n        time: ''\n      },\n      fileList: [],\n      pointerImg: pointerImg,\n      drawing: false,\n      keyWord: ''\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {\n      drawPoi = new DrawPoi(this)\n    })\n    this.loadData()\n  },\n  beforeDestroy() {\n    drawPoi.clear()\n    drawPoi.drawCancel()\n  },\n  methods: {\n    loadData() {\n      FileSave.getList().then(res => {\n        console.log('res', res)\n        if (res) {\n          const list = res\n          // set photo 0\n          list.forEach(item => {\n            if (item.photos) {\n              const arr = item.photos.split('#')\n              if (arr.length > 0) {\n                item['photo0'] = arr[0]\n                item['photoArr'] = arr\n              }\n            }\n          })\n          this.dataList = list\n        } else {\n          this.dataList = []\n        }\n      })\n    },\n    startDraw() {\n      this.drawing = true\n      this.fileList = []\n      drawPoi.draw()\n    },\n    cancelDraw() {\n      drawPoi.drawCancel()\n      this.drawing = false\n    },\n    backToList() {\n      this.page = 'list'\n      drawPoi.clear()\n      this.$refs.poiForm.resetFields()\n    },\n    save() {\n      this.$refs.poiForm.validate(valid => {\n        if (!valid) {\n          return\n        }\n        const currentPoint = this.currentPoint\n\n        const param = {\n          name: currentPoint.name,\n          time: currentPoint.time,\n          longitude: currentPoint.lng,\n          latitude: currentPoint.lat,\n          altitude: currentPoint.altitude || 0,\n          photos: '',\n          address: '',\n          desc: currentPoint.desc || ''\n        }\n        const photos = []\n        console.log('this.fileList', this.fileList)\n        if (this.fileList.length > 0) {\n          this.fileList.forEach(f => {\n            photos.push(f.name)\n          })\n        }\n        if (photos.length > 0) {\n          param.photos = photos.join('#')\n        }\n\n        if (currentPoint.id) {\n          const item = this.dataList.find(d => d.id === currentPoint.id)\n          if (item) {\n            item.name = currentPoint.name || ''\n            item.time = currentPoint.time || ''\n            item.longitude = currentPoint.lng\n            item.latitude = currentPoint.lat\n            item.altitude = currentPoint.altitude || 0,\n            item.photos = param.photos\n            item.address = param.address\n            item.desc = currentPoint.desc || ''\n            FileSave.create(this.dataList).then(res => {\n              this.$messageSuccess()\n              this.backToList()\n            })\n          }\n        } else {\n          param['id'] = getUuid()\n          this.dataList.push(param)\n          FileSave.create(this.dataList).then(res => {\n            this.$messageSuccess()\n            this.backToList()\n          })\n        }\n      })\n    },\n    flyTo(item) {\n      drawPoi.flyTo(item)\n    },\n    edit(item) {\n      this.fileList = []\n      const photos = item.photos\n      if (photos) {\n        const arr = photos.split('#')\n        arr.forEach(url => {\n          this.fileList.push({\n            status: 'done',\n            url: url,\n            name: url,\n            uid: getUuid()\n          })\n        })\n      }\n      drawPoi.edit(item)\n    },\n    deleteClick(item) {\n      const idx = this.dataList.findIndex(d => d.id === item.id)\n      this.dataList.splice(idx, 1)\n      FileSave.create(this.dataList).then(res => {\n        this.$messageSuccess()\n        this.loadData()\n        drawPoi.clearById(item.id)\n      })\n    },\n    listChange(list) {\n      this.fileList = list\n    },\n    latLngChange(v) {\n      if (this.currentPoint.lat && this.currentPoint.lng) {\n        drawPoi.setLatLng(this.currentPoint.lat, this.currentPoint.lng)\n      }\n    },\n    poiSwitch(e) {\n      if (e.target.checked) {\n        saveRecord('地图中查看所有兴趣点分布', '11', '1')\n        PoiContext.getLayer().show()\n      } else {\n        PoiContext.getLayer().hide()\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n\n.poiImg {\n  width: 40px;\n  height: 40px;\n  border-radius: 5px;\n}\n</style>\n"],"mappings":"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"}]}