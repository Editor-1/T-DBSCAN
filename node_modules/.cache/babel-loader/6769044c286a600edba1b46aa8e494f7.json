{"remainingRequest":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\babel-loader\\lib\\index.js!D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\workspace_wm\\web-ui-travel\\src\\components\\ImageUpload\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\work\\workspace_wm\\web-ui-travel\\src\\components\\ImageUpload\\index.vue","mtime":1719903068845},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\babel.config.js","mtime":1677117676000},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\workspace_wm\\web-ui-travel\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnB1c2guanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXguanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZS5qcyIpOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwoKZnVuY3Rpb24gdmFsaWRhdGVJbWFnZShmaWxlKSB7CiAgdmFyIGlzSnBnT3JQbmcgPSBmaWxlLnR5cGUgPT09ICdpbWFnZS9qcGVnJyB8fCBmaWxlLnR5cGUgPT09ICdpbWFnZS9wbmcnIHx8IGZpbGUudHlwZSA9PT0gJ2ltYWdlL2pwZyc7CiAgaWYgKCFpc0pwZ09yUG5nKSB7CiAgICByZXR1cm47CiAgfQogIHZhciBpc0x0Mk0gPSBmaWxlLnNpemUgLyAxMDI0IC8gMTAyNCA8IDIwOyAvLyAyME0KICBpZiAoIWlzTHQyTSkgewogICAgcmV0dXJuOwogIH0KICByZXR1cm4gaXNKcGdPclBuZyAmJiBpc0x0Mk07Cn0KdmFyIF9kZWZhdWx0ID0gewogIG5hbWU6ICdJbWFnZVVwbG9hZCcsCiAgcHJvcHM6IHsKICAgIC8vIOm7mOiupOWIl+ihqAogICAgZmlsZUxpc3Q6IHsKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIHR5cGU6IEFycmF5CiAgICB9LAogICAgLy8g55So5oi35aS05YOPID0g44CLdXNlcu+8jOiuvuWkh+eFp+eJhyA944CLIGRldmljZe+8jOWFtOi2o+eCueeFp+eJhyA944CLcG9pIO+8jOaEj+ingeWPjemmiOeFp+eJhyA944CLIGFkdmljZQogICAgdHlwZTogewogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAnJwogICAgfSwKICAgIC8vIOmZkOWItuaVsOmHjwogICAgbnVtOiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogNgogICAgfSwKICAgIGxpc3RUeXBlOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJ3BpY3R1cmUtY2FyZCcKICAgIH0sCiAgICByZWFkeU9ubHk6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0KICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBoZWFkZXJzOiBudWxsLAogICAgICBiYXNlVXJsOiBwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJICsgJy9pbWFnZXMvJywKICAgICAgdXBsb2FkSW1nVXJsOiBwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJICsgIi91cGxvYWQtaW1hZ2UiLAogICAgICAvLyDkuIrkvKDnmoTlm77niYfmnI3liqHlmajlnLDlnYAKICAgICAgcHJldmlld1Zpc2libGU6IGZhbHNlLAogICAgICBwcmV2aWV3SW1hZ2U6ICcnLAogICAgICBsaXN0OiBbXQogICAgfTsKICB9LAogIHdhdGNoOiB7CiAgICBmaWxlTGlzdDogZnVuY3Rpb24gZmlsZUxpc3QoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIGNvbnNvbGUubG9nKCd0aGlzLmZpbGVMaXN0JywgdGhpcy5maWxlTGlzdCk7CiAgICAgIHRoaXMuZmlsZUxpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGl0ZW1bJ3VybCddID0gX3RoaXMuYmFzZVVybCArIGl0ZW0ubmFtZTsKICAgICAgfSk7CiAgICAgIHRoaXMubGlzdCA9IHRoaXMuZmlsZUxpc3Q7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBoYW5kbGVQcmV2aWV3OiBmdW5jdGlvbiBoYW5kbGVQcmV2aWV3KGZpbGUpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgIHRoaXMucHJldmlld0ltYWdlID0gZmlsZS51cmw7CiAgICAgIC8vIHRoaXMucHJldmlld1Zpc2libGUgPSB0cnVlCiAgICAgIHZhciB1cmxzID0gW107CiAgICAgIHRoaXMubGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgdXJscy5wdXNoKGl0ZW0udXJsKTsKICAgICAgfSk7CiAgICAgIC8qIGNvbnN0IHZWaWV3ZXIgPSB0aGlzLiR2aWV3ZXJBcGkoewogICAgICAgIGltYWdlczogdXJscywKICAgICAgICB1cmw6IGZpbGUudXJsCiAgICAgIH0pICovCiAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgaWR4ID0gX3RoaXMyLmxpc3QuZmluZEluZGV4KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICByZXR1cm4gZC51cmwgPT09IGZpbGUudXJsOwogICAgICAgIH0pOwogICAgICAgIC8vIHZWaWV3ZXIudXBkYXRlKCkudmlldyhpZHgpCiAgICAgIH0pOwogICAgfSwKICAgIGhhbmRsZVVwbG9hZFN1Y2Nlc3M6IGZ1bmN0aW9uIGhhbmRsZVVwbG9hZFN1Y2Nlc3MocmVzLCBmaWxlLCBmaWxlTGlzdCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgY29uc29sZS5sb2coJ3JlcywgZmlsZScsIHJlcywgZmlsZSwgZmlsZUxpc3QpOwogICAgICBmaWxlTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgaWYgKGl0ZW0ucmVzcG9uc2UpIHsKICAgICAgICAgIGl0ZW1bJ3VybCddID0gX3RoaXMzLmJhc2VVcmwgKyBpdGVtLnJlc3BvbnNlLmZpbGVOYW1lOwogICAgICAgICAgaXRlbVsnbmFtZSddID0gaXRlbS5yZXNwb25zZS5maWxlTmFtZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmxpc3QgPSBmaWxlTGlzdDsKICAgICAgaWYgKHJlcy5jb2RlID09PSAyMDApIHt9IGVsc2UgaWYgKGZpbGUuc3RhdHVzID09PSAncmVtb3ZlZCcpIHt9IGVsc2UgewogICAgICAgIC8vIOWmguS9leWksei0pe+8jOWIoOmZpOacgOWQjuS4gOS4qgogICAgICAgIGlmICghZmlsZS5iYikgewogICAgICAgICAgZmlsZUxpc3Quc3BsaWNlKGZpbGVMaXN0Lmxlbmd0aCAtIDEsIDEpOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLiRlbWl0KCdsaXN0Q2hhbmdlJywgZmlsZUxpc3QpOwogICAgfSwKICAgIGhhbmRsZUJlZm9yZVVwbG9hZDogZnVuY3Rpb24gaGFuZGxlQmVmb3JlVXBsb2FkKGZpbGUpIHsKICAgICAgdmFyIGJiID0gdmFsaWRhdGVJbWFnZShmaWxlKTsKICAgICAgZmlsZVsnYmInXSA9IGJiOwogICAgICByZXR1cm4gYmI7CiAgICB9CiAgfQp9OwpleHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDs="},{"version":3,"names":["validateImage","file","isJpgOrPng","type","isLt2M","size","_default","name","props","fileList","required","Array","String","default","num","Number","listType","readyOnly","Boolean","data","headers","baseUrl","process","env","VUE_APP_BASE_API","uploadImgUrl","previewVisible","previewImage","list","watch","_this","console","log","forEach","item","methods","handlePreview","_this2","url","urls","push","$nextTick","idx","findIndex","d","handleUploadSuccess","res","_this3","response","fileName","code","status","bb","splice","length","$emit","handleBeforeUpload","exports"],"sources":["src/components/ImageUpload/index.vue"],"sourcesContent":["<template>\n  <div class=\"component-upload-image\">\n    <el-upload\n      multiple\n      :action=\"uploadImgUrl\"\n      list-type=\"picture-card\"\n      name=\"image\"\n      :on-success=\"handleUploadSuccess\"\n      :before-upload=\"handleBeforeUpload\"\n      ref=\"imageUpload\"\n      :show-file-list=\"true\"\n      :file-list=\"fileList\"\n    >\n      <i class=\"el-icon-plus\"></i>\n    </el-upload>\n  </div>\n</template>\n\n<script>\nfunction validateImage(file) {\n  const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png' || file.type === 'image/jpg'\n  if (!isJpgOrPng) {\n    return\n  }\n  const isLt2M = file.size / 1024 / 1024 < 20 // 20M\n  if (!isLt2M) {\n    return\n  }\n  return isJpgOrPng && isLt2M\n}\nexport default {\n  name: 'ImageUpload',\n  props: {\n    // 默认列表\n    fileList: {\n      required: true,\n      type: Array\n    },\n    // 用户头像 = 》user，设备照片 =》 device，兴趣点照片 =》poi ，意见反馈照片 =》 advice\n    type: {\n      required: true,\n      type: String,\n      default: ''\n    },\n    // 限制数量\n    num: {\n      type: Number,\n      default: 6\n    },\n    listType: {\n      type: String,\n      default: 'picture-card'\n    },\n    readyOnly: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      headers: null,\n      baseUrl: process.env.VUE_APP_BASE_API + '/images/',\n      uploadImgUrl: process.env.VUE_APP_BASE_API + \"/upload-image\", // 上传的图片服务器地址\n      previewVisible: false,\n      previewImage: '',\n      list: []\n    }\n  },\n  watch: {\n    fileList() {\n      console.log('this.fileList', this.fileList)\n      this.fileList.forEach(item => {\n        item['url'] = this.baseUrl + item.name\n      })\n      this.list = this.fileList\n    }\n  },\n  methods: {\n    handlePreview(file) {\n      this.previewImage = file.url\n      // this.previewVisible = true\n      const urls = []\n      this.list.forEach(item => {\n        urls.push(item.url)\n      })\n      /* const vViewer = this.$viewerApi({\n        images: urls,\n        url: file.url\n      }) */\n      this.$nextTick(() => {\n        const idx = this.list.findIndex(d => d.url === file.url)\n        // vViewer.update().view(idx)\n      })\n    },\n    handleUploadSuccess(res, file, fileList) {\n      console.log('res, file', res, file, fileList)\n      fileList.forEach(item => {\n        if (item.response) {\n          item['url'] = this.baseUrl + item.response.fileName\n          item['name'] = item.response.fileName\n        }\n      })\n      this.list = fileList\n      if (res.code === 200) {\n      } else if (file.status === 'removed') {\n      } else {\n        // 如何失败，删除最后一个\n        if (!file.bb) {\n          fileList.splice(fileList.length - 1, 1)\n        }\n      }\n      this.$emit('listChange', fileList)\n    },\n    handleBeforeUpload(file) {\n      const bb = validateImage(file)\n      file['bb'] = bb\n      return bb\n    }\n  }\n};\n</script>\n<style scoped lang=\"scss\">\n// .el-upload--picture-card 控制加号部分\n::v-deep.hide .el-upload--picture-card {\n  display: none;\n}\n// 去掉动画效果\n::v-deep .el-list-enter-active,\n::v-deep .el-list-leave-active {\n  transition: all 0s;\n}\n\n::v-deep .el-list-enter, .el-list-leave-active {\n  opacity: 0;\n  transform: translateY(0);\n}\n</style>\n\n"],"mappings":"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"}]}